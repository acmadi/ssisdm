/*[jQuery Plugin,Table Navigation and Manipulation,version 1.1,copyright A. Sonhaji,Sintesa Solusi Utama,20/07/2011]*/
(function($){$.table=function(t){var r=null;var index=0;var rows={};var settings={log:null,exclude:[],onEnter:function(){},onDelete:function(){},onInsert:function(){},onKeydown:function(){return true;}};var selector="";var self=$(t);self.data('table',this);this.init=function(options){if(options){options=$.extend(settings,options);}
options.exclude.length?selector="tbody tr:not("+options.exclude.join(',')+")":selector="tbody tr";rows=$(selector,self);self.delegate("tr","focus",function(e){r=$(this);r.addClass("highlight");index=rows.index(r);options.log&&options.log.text(r.text());}).delegate("tr","blur",function(e){r=null;$(this).removeClass("highlight");}).delegate("tr","click",function(e){if(rows.index($(this))>=0)$(this).focus();}).delegate("tr","keydown",function(e){var k=e.keyCode||e.charCode||e.which||-1;switch(k){case 13:options.onEnter(r);return false;break;case 46:return options.onDelete(r);break;case 45:return options.onInsert(r);break;case 38:index--;r=rows.eq(index);r.focus();return false;case 40:index++;if(index>=rows.length)index=0;r=rows.eq(index);r.focus();return false;default:return options.onKeydown(k,r);break;}})}
this.remove=function(row,hl){row.remove();rows=$(selector,self);if(index>=rows.length)index--;options.log&&options.log.text(index);if(hl&&(index>=0)){r=rows.eq(index);r.focus();}};this.edit=function(row){}
this.insert=function(row,r,hl){row=$(row);if(r){row.insertBefore(r);}else{self.find('tbody:last').append(row);}
rows=$(selector,self);if(hl){if(row.length>1)r=row.eq(0);else r=row;r.focus();}};this.update=function(){rows=$(selector,self);if(index>=rows.length)index=rows.length-1;r=rows.eq(index);r.focus();};}
$.fn.nmtable=function(method){var args=arguments;return this.each(function(){if(method=='insert'){var table=$(this).data('table');table.insert.apply(table,Array.prototype.slice.call(args,1));}else if(method=='update'){var table=$(this).data('table');table.update();}else if(typeof method==='object'||!method){var table=new $.table(this);table.init(method);}else{$.error('Method '+method+' does not exist on jQuery.nmtable');}})}})(jQuery);
